<!doctype html><html class=no-js lang=zh-cn><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta http-equiv=x-ua-compatible content="IE=edge"><title>Redis必知必会 - 神秘极客</title><script>(function(d,e){d[e]=d[e].replace("no-js","js");})(document.documentElement,"className");</script><meta name=description content><link rel=dns-prefetch href=//fonts.googleapis.com><link rel=dns-prefetch href=//fonts.gstatic.com><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Open+Sans:400,400i,700"><link rel=stylesheet href=/css/style.css><link rel="shortcut icon" href=/favicon.ico></head><body class=body><div class="container container--outer"><header class=header><div class=container><div class=logo><a class=logo__link href=/ title=神秘极客 rel=home><div class=logo__title>神秘极客</div><div class=logo__tagline>学习编程之美</div></a></div><nav class=menu><button class=menu__btn aria-haspopup=true aria-expanded=false tabindex=0>
<span class=menu__btn-title tabindex=-1>菜单</span></button><ul class=menu__list><li class=menu__item><a class=menu__link href=/archives/><i class="fa fa-road"></i><span class=menu__text>学编程</span></a></li><li class=menu__item><a class=menu__link href=/about/><i class="fa fa-heart"></i><span class=menu__text>关于我</span></a></li><li class=menu__item><a class=menu__link href=/donate/><i class="fa fa-heart"></i><span class=menu__text>捐赠</span></a></li></ul></nav></div></header><div class="wrapper flex"><div class=primary><main class=main role=main><article class=post><header class=post__header><h1 class=post__title>Redis必知必会</h1></header><div class="post__toc toc"><div class=toc__title>目录</div><div class=toc__menu><nav id=TableOfContents><ul><li><ul><li><a href=#什么是redis>什么是Redis</a></li><li><a href=#为什么要用redis>为什么要用Redis</a></li><li><a href=#怎么用redis>怎么用Redis</a></li><li><a href=#参考链接>参考链接</a></li></ul></li></ul></nav></div></div><div class="content post__content clearfix"><h3 id=什么是redis>什么是Redis</h3><p>Redis是一个开源、基于内存的键值对存储数据库。通常情况下，键的类型都是字符串，值的类型有多种，Redis支持值的数据结构如下：</p><ol><li>字符串</li><li>散列</li><li>列表</li><li>集合</li><li>有序集合</li><li>位图</li></ol><p>Redis键和常见的值类型</p><table><thead><tr><th align=left>键类型(key)</th><th align=left>特点</th><th align=left>备注</th></tr></thead><tbody><tr><td align=left></td><td align=left>二进制安全</td><td align=left>任何二进制序列作为键</td></tr><tr><td align=left></td><td align=left>较短的键占用内存较少</td><td align=left></td></tr><tr><td align=left></td><td align=left>非常短的键，不利于语义化</td><td align=left>需要在键的可读性和更少的内存消耗，找到合适平衡点。</td></tr><tr><td align=left></td><td align=left>尝试坚持使用固定的模式</td><td align=left>例如，object-type:id => user:1000</td></tr><tr><td align=left></td><td align=left>键最大为512MB</td><td align=left></td></tr><tr><td align=left>Strings</td><td align=left>SET/GET 设置和获取字符串值</td><td align=left>与Redis键关联最简单的值类型</td></tr><tr><td align=left></td><td align=left></td><td align=left>支持包括二进制数据的字符串，最大512MB</td></tr><tr><td align=left></td><td align=left>SET nx</td><td align=left>如果key不存在就设置值</td></tr><tr><td align=left></td><td align=left>SET xx</td><td align=left>如果key存在才更新值</td></tr><tr><td align=left></td><td align=left>SET ex</td><td align=left>设置指定的过期时间，多少秒</td></tr><tr><td align=left></td><td align=left>SET px</td><td align=left>设置指定过期时间，多少毫秒</td></tr><tr><td align=left></td><td align=left>INCR key</td><td align=left>解析字符串作为整数，自增1，得到的值作为新的值</td></tr><tr><td align=left></td><td align=left>EXISTS key</td><td align=left>检查当前数据库是否存在给定的键</td></tr><tr><td align=left></td><td align=left>DEL key</td><td align=left>删除键和关联的值</td></tr><tr><td align=left></td><td align=left>TTL key</td><td align=left>检查键的剩余生存时间</td></tr><tr><td align=left>列表(List)</td><td align=left>通过链表实现</td><td align=left>在常量时间内添加新元素到头部或者尾部，访问元素所需时间跟元素的索引成正比</td></tr><tr><td align=left></td><td align=left>LPUSH key value</td><td align=left>将新元素添加到列表左侧，也就是头部</td></tr><tr><td align=left></td><td align=left>RPUSH key value</td><td align=left>将新元素添加到列表右侧，也就是尾部</td></tr><tr><td align=left></td><td align=left>LRANGE key 0 size-1</td><td align=left>从列表获取指定范围的元素，可以为负数。-1是最后一个元素，-2列表倒数第2个元素</td></tr><tr><td align=left></td><td align=left>RPOP key</td><td align=left>从列表查找元素并同时从列表尾部弹出元素</td></tr><tr><td align=left></td><td align=left>LPOP key</td><td align=left>从列表查找元素并同时从列表头部弹出元素</td></tr><tr><td align=left></td><td align=left>LTRIM key 0 2</td><td align=left>只保存最新的N个元素，并丢弃所有最旧的元素</td></tr><tr><td align=left></td><td align=left>BRPOP key</td><td align=left>阻塞版本的RPOP，等待指定列表的元素到达，若超时就立即返回。</td></tr><tr><td align=left></td><td align=left>BLPOP key</td><td align=left>阻塞版本的LPOP，等待指定列表的元素到达，若超时就立即返回。</td></tr><tr><td align=left></td><td align=left></td><td align=left>客户端以有序方式获取元素，返回值为2个元素的数组，超时则返回NULL</td></tr><tr><td align=left>hash(哈希)</td><td align=left>hmset key k1 v1 k2 v2</td><td align=left>设置哈希键多个字段值</td></tr><tr><td align=left></td><td align=left>hget key k1</td><td align=left>获取散列中的指定字段</td></tr><tr><td align=left></td><td align=left>hget key k2</td><td align=left></td></tr><tr><td align=left></td><td align=left>hmget key k1 k2</td><td align=left>返回散列表中的多个字段值</td></tr><tr><td align=left></td><td align=left>hincrby key k1 value</td><td align=left>对散列表中的指定字段自增值</td></tr><tr><td align=left>集合(Set)</td><td align=left></td><td align=left>该集合是无序的</td></tr><tr><td align=left></td><td align=left>sadd myset 1 2 3</td><td align=left>给指定集合添加多个元素</td></tr><tr><td align=left></td><td align=left>smembers myset</td><td align=left>返回指定集合的元素</td></tr><tr><td align=left></td><td align=left>sismember myset 3</td><td align=left>检查集合中元素是否存在</td></tr><tr><td align=left></td><td align=left>sinter k1 k2 k3</td><td align=left>执行多个键间的交集</td></tr><tr><td align=left></td><td align=left>spop key</td><td align=left>随机删除一个集合中的元素</td></tr><tr><td align=left></td><td align=left>sunionstore k1 k2</td><td align=left>获取多个集合对应的并集，存储到第一个集合中。</td></tr><tr><td align=left></td><td align=left>scard key</td><td align=left>获取指定集合的元素个数</td></tr><tr><td align=left>有序集合(Sort Set)</td><td align=left>zadd key score value</td><td align=left>添加有序集合的分数和值</td></tr><tr><td align=left></td><td align=left></td><td align=left>内部实现是采用跳表+散列表实现。</td></tr><tr><td align=left></td><td align=left>zrang key 0 -1</td><td align=left>返回指定有序集合全部元素，默认为升序</td></tr><tr><td align=left></td><td align=left>zrevrangekey 0 -1</td><td align=left>倒序返回元素</td></tr><tr><td align=left></td><td align=left>zrangebyscore key -inf 1950</td><td align=left>获取指定的排序之后的元素</td></tr><tr><td align=left></td><td align=left>zremrangebyscore key 1940 1960</td><td align=left>删除指定范围内的元素</td></tr><tr><td align=left></td><td align=left>zrank key value</td><td align=left>查询值所在的位置</td></tr><tr><td align=left>位图(bit)</td><td align=left>SETBIT key 10 1</td><td align=left>设置指定位图值</td></tr><tr><td align=left></td><td align=left>GETBIT key 10</td><td align=left>获取指定位图值</td></tr><tr><td align=left></td><td align=left>BITCOUNT key</td><td align=left>计算设置为1位的计数</td></tr></tbody></table><h3 id=为什么要用redis>为什么要用Redis</h3><ol><li>Redis的访问速度快，完全基于内存操作，网络层采用epoll单线程解决高并发的问题。</li><li>Redis有着丰富的数据类型，常见有5种：string、Hash、List、Set、SortSet、Bit等。</li></ol><h3 id=怎么用redis>怎么用Redis</h3><h4 id=redis列表>Redis列表</h4><p>列表对很多任务都有用，比如：</p><ol><li>记住用户发布到社交网络的最新更新。</li><li>流程之间的通信。</li><li>使用生产者将消息推入列表的消费者-生产者模式。</li></ol><h4 id=redis集合>Redis集合</h4><p>标记新闻文章的标签。假设文章id为1000，有标签1，2，5，77，那么你可以设计：</p><pre><code>sadd news:1000:tags 1 2 55 77
</code></pre><p>也许你想要反向关系，标签对应的文章列表</p><pre><code>sadd tag:1:news 1000
sadd tag:2:news 1000
sadd tag:5:news 1000
sadd tag:77:news 1000

smembers news:1000:tags
</code></pre><p>为了模拟基于网络的扑克游戏，你可以使用（C）lubs(黑梅花)，（D）iamonds(红方块)，（H）earts(红心)，（S）pades(黑桃) 标识牌面的不同花色：</p><pre><code>sadd deck C1 C2 C3 C4 C5 C6 C7 C8 C9 C10 CJ CQ CK
   D1 D2 D3 D4 D5 D6 D7 D8 D9 D10 DJ DQ DK H1 H2 H3
   H4 H5 H6 H7 H8 H9 H10 HJ HQ HK S1 S2 S3 S4 S5 S6
   S7 S8 S9 S10 SJ SQ SK
</code></pre><h4 id=redis位图>Redis位图</h4><p>实现一个用户每日访问的最长连续性。位索引为，获取当前的unix时间戳，减去初始偏移量，然后除以3600*24。对于每一个用户都有一个包含每天访问信息的小字符串。使用BITCOUNT获取给定用户访问网站的天数，BITPOS调用，计算出最长的天数。</p><p>假设网站公开的日期为20190502，转化为时间戳为1556726400，那么位索引的计算公式为=(当前00:00:00的时间戳-1556726400)/(3600*24)取整，那么20190502的索引为0，20190503的索引，那么刚好=1。通过BITCOUNT可以计算出用户在指定期间访问网站的天数。</p><h3 id=参考链接>参考链接</h3><ol><li><a href=https://redis.io/topics/data-types-intro>介绍Redis数据类型和抽象</a></li><li><a href=https://redis.io/topics/data-types>数据类型</a></li><li><a href=https://juejin.im/post/5b516dc75188251af363492d>为什么要用Redis</a></li></ol><p><img src=https://xbc.me/wp-content/uploads/2019.05.06.png alt=img></p></div></article></main><div class="authorbox clearfix"><figure class=authorbox__avatar><img alt="GeekWho avatar" src=/images/avatar.jpeg class=avatar height=90 width=90></figure><div class=authorbox__header><span class=authorbox__name>关于 GeekWho</span></div><div class=authorbox__description>PHP and Go are the best language in the world.</div></div><div id=gitalk-container></div><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.css><script src=https://cdn.jsdelivr.net/npm/gitalk@1/dist/gitalk.min.js></script><script>const gitalk=new Gitalk({clientID:'13b47a49e0f947bf69e0',clientSecret:'a4f2f9622955ed3993f37d1b82eddab12abdeffe',repo:'xbc.me',owner:'geekwho11',admin:['geekwho11'],id:location.pathname,distractionFreeMode:false});(function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById('gitalk-container').innerHTML='Gitalk comments not available by default when the website is previewed locally.';return;}
gitalk.render('gitalk-container');})();</script></div><aside class=sidebar><div class="widget-search widget"><form class=widget-search__form role=search method=get action=https://google.com/search><label><input class=widget-search__field type=search placeholder=搜索... name=q aria-label=搜索...></label>
<input class=widget-search__submit type=submit value=Search>
<input type=hidden name=sitesearch value=/></form></div><div class="widget-recent widget"><h4 class=widget__title>近期文章</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/php-short-syntax-and-operator/>PHP的简化运算符</a></li><li class=widget__item><a class=widget__link href=/rd-environment/>研发环境那些事</a></li><li class=widget__item><a class=widget__link href=/php-autoload/>PHP自动加载</a></li><li class=widget__item><a class=widget__link href=/swoole/>Swoole必知必会</a></li><li class=widget__item><a class=widget__link href=/etcd/>Etcd必知必会</a></li></ul></div></div><div class="widget-categories widget"><h4 class=widget__title>分类</h4><div class=widget__content><ul class=widget__list><li class=widget__item><a class=widget__link href=/categories/%E5%AD%A6%E7%BC%96%E7%A8%8B/>学编程</a></li><li class=widget__item><a class=widget__link href=/categories/%E7%A5%9E%E7%A7%98%E6%9E%81%E5%AE%A2/>神秘极客</a></li><li class=widget__item><a class=widget__link href=/categories/%E9%9A%8F%E7%AC%94/>随笔</a></li></ul></div></div><div class="widget-taglist widget"><h4 class=widget__title>标签</h4><div class=widget__content><a class="widget-taglist__link widget__link btn" href=/tags/go/ title=Go>Go</a>
<a class="widget-taglist__link widget__link btn" href=/tags/javascript/ title=JavaScript>JavaScript</a>
<a class="widget-taglist__link widget__link btn" href=/tags/linux/ title=Linux>Linux</a>
<a class="widget-taglist__link widget__link btn" href=/tags/magento/ title=Magento>Magento</a>
<a class="widget-taglist__link widget__link btn" href=/tags/mysql/ title=MySQL>MySQL</a>
<a class="widget-taglist__link widget__link btn" href=/tags/nginx/ title=Nginx>Nginx</a>
<a class="widget-taglist__link widget__link btn" href=/tags/php/ title=PHP>PHP</a>
<a class="widget-taglist__link widget__link btn" href=/tags/ubuntu/ title=Ubuntu>Ubuntu</a>
<a class="widget-taglist__link widget__link btn" href=/tags/unittest/ title=UnitTest>UnitTest</a>
<a class="widget-taglist__link widget__link btn" href=/tags/wordpress/ title=WordPress>WordPress</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%89%8D%E7%AB%AF/ title=前端>前端</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%90%8E%E7%AB%AF/ title=后端>后端</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%B8%B8%E8%A7%81%E7%AE%97%E6%B3%95/ title=常见算法>常见算法</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E5%B9%B4%E7%BB%88%E6%80%BB%E7%BB%93/ title=年终总结>年终总结</a>
<a class="widget-taglist__link widget__link btn" href=/tags/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/ title=数据结构>数据结构</a></div></div><div class="widget-social widget"><h4 class="widget-social__title widget__title">社交</h4><div class="widget-social__content widget__content"><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=GitHub rel="noopener noreferrer" href=https://github.com/geekwho11 target=_blank><svg class="widget-social__link-icon icon icon-github" width="24" height="24" viewBox="0 0 384 374"><path d="m192 0C85.9.0.0 85.8.0 191.7c0 84.7 55 156.6 131.3 181.9 9.6 1.8 13.1-4.2 13.1-9.2.0-4.6-.2-16.6-.3-32.6-53.4 11.6-64.7-25.7-64.7-25.7-8.7-22.1-21.3-28-21.3-28-17.4-11.9 1.3-11.6 1.3-11.6 19.3 1.4 29.4 19.8 29.4 19.8 17.1 29.3 44.9 20.8 55.9 15.9 1.7-12.4 6.7-20.8 12.2-25.6-42.6-4.8-87.5-21.3-87.5-94.8.0-20.9 7.5-38 19.8-51.4-2-4.9-8.6-24.3 1.9-50.7.0.0 16.1-5.2 52.8 19.7 15.3-4.2 31.7-6.4 48.1-6.5 16.3.1 32.7 2.2 48.1 6.5 36.7-24.8 52.8-19.7 52.8-19.7 10.5 26.4 3.9 45.9 1.9 50.7 12.3 13.4 19.7 30.5 19.7 51.4.0 73.7-44.9 89.9-87.7 94.6 6.9 5.9 13 17.6 13 35.5.0 25.6-.2 46.3-.2 52.6.0 5.1 3.5 11.1 13.2 9.2 76.2-25.5 131.2-97.3 131.2-182 0-105.9-86-191.7-192-191.7z"/></svg><span>GitHub</span></a></div><div class="widget-social__item widget__item"><a class="widget-social__link widget__link btn" title=Email href=mailto:geekwho@xbc.me><svg class="widget-social__link-icon icon icon-mail" width="24" height="24" viewBox="0 0 416 288"><path d="m0 16v256 16h16 384 16v-16V16 0h-16H16 0zm347 16-139 92.5L69 32zM199 157.5l9 5.5 9-5.5L384 46v210H32V46z"/></svg><span>geekwho@xbc.me</span></a></div></div></div></aside></div><footer class=footer><div class="container footer__container flex"><div class=footer__copyright>&copy; 2020 神秘极客.
<span class=footer__copyright-credits>基于 <a href=https://gohugo.io/ rel="nofollow noopener" target=_blank>Hugo</a> 引擎和 <a href=https://github.com/Vimux/Mainroad/ rel="nofollow noopener" target=_blank>Mainroad</a>主題</span></div></div></footer></div><script async defer src=/js/menu.js></script></body></html>